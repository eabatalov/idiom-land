<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>QuestBootstrap</name>
    <events>
        <event-group description="" sid="1015458994841946" title="Local var scope">
            <sub-events>
                <variable constant="0" name="LEVEL_ANIMS_INITED_CNT" sid="4069008834354208" static="1" type="number">0</variable>
                <variable constant="0" name="LEVEL_ANIMS_TO_INIT" sid="1033884765458331" static="1" type="number">-1</variable>
                <variable constant="0" name="LEVEL_LAYOUT_INITED" sid="8205382910114632" static="1" type="number">0</variable>
                <variable constant="0" name="LEVEL_NAME" sid="1759465988552774" static="1" type="text"></variable>
                <variable constant="0" name="LEVEL_FIRST_STAGE" sid="7624579566355837" static="1" type="text"></variable>
                <comment>Each new level(layout) requires reinitialization of variables&#x0D;&#x0A;Call &quot;onStartOfLayout&quot; only after start of layout was processed (initial state is set)</comment>
                <event-block sid="5627974527415635">
                    <conditions>
                        <condition id="-2" name="On start of layout" sid="3961638465824698" type="System" />
                    </conditions>
                    <actions>
                        <action id="-9" name="Set value" sid="6276884142808683" type="System">
                            <param id="0" name="Variable">LEVEL_ANIMS_INITED_CNT</param>
                            <param id="1" name="Value">0</param>
                        </action>
                        <action id="-9" name="Set value" sid="7259303845996656" type="System">
                            <param id="0" name="Variable">LEVEL_ANIMS_TO_INIT</param>
                            <param id="1" name="Value">-1</param>
                        </action>
                        <action id="-9" name="Set value" sid="7802182076251335" type="System">
                            <param id="0" name="Variable">LEVEL_LAYOUT_INITED</param>
                            <param id="1" name="Value">0</param>
                        </action>
                        <action id="-9" name="Set value" sid="2784356679304557" type="System">
                            <param id="0" name="Variable">LEVEL_NAME</param>
                            <param id="1" name="Value">&quot;&quot;</param>
                        </action>
                        <action id="-9" name="Set value" sid="9608529023367603" type="System">
                            <param id="0" name="Variable">LEVEL_FIRST_STAGE</param>
                            <param id="1" name="Value">&quot;&quot;</param>
                        </action>
                        <action id="0" name="Call function" sid="4575080265911879" type="Function">
                            <param id="0" name="Name">&quot;onStartOfLayout&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                    </actions>
                </event-block>
                <comment>First stage of initialization: init all the visual construct objects, init all the scml animations.&#x0D;&#x0A;&#x0D;&#x0A;XXX: for some reason we can&apos;t call IniUI from InitGame&#x0D;&#x0A;Probably sprite positions change after load of layout and we compute some invalid offsets.</comment>
                <comment>Starts quest initialization and execution (from 1st stage).&#x0D;&#x0A;param(0): level name&#x0D;&#x0A;param(1): number of NPC scml animations on the level (+1 will be added for player animation)&#x0D;&#x0A;param(2): initial level stage</comment>
                <event-block sid="4009566570811764">
                    <conditions>
                        <condition id="0" name="On function" sid="2896692718437938" type="Function">
                            <param id="0" name="Name">&quot;StartLevel&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action disabled="1" id="14" name="Log" sid="4706235827688399" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;StartLevel&quot;</param>
                        </action>
                        <action id="0" name="Call function" sid="3374487306171643" type="Function">
                            <param id="0" name="Name">&quot;InitUI&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                        <action id="0" name="Call function" sid="5268206462800991" type="Function">
                            <param id="0" name="Name">&quot;VarsReset&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                        <action id="-9" name="Set value" sid="4264590270856551" type="System">
                            <param id="0" name="Variable">LEVEL_NAME</param>
                            <param id="1" name="Value">Function.Param(0)</param>
                        </action>
                        <action id="-9" name="Set value" sid="5154692278915349" type="System">
                            <param id="0" name="Variable">LEVEL_ANIMS_TO_INIT</param>
                            <param id="1" name="Value">Function.Param(1) + 1</param>
                        </action>
                        <action id="-9" name="Set value" sid="1106964463494173" type="System">
                            <param id="0" name="Variable">LEVEL_FIRST_STAGE</param>
                            <param id="1" name="Value">Function.Param(2)</param>
                        </action>
                        <action id="-9" name="Set value" sid="7995133675498134" type="System">
                            <param id="0" name="Variable">LEVEL_LAYOUT_INITED</param>
                            <param id="1" name="Value">1</param>
                        </action>
                    </actions>
                    <sub-events>
                        <event-block sid="2991987067297528">
                            <conditions>
                                <condition id="-8" name="Compare two values" sid="3785321760266058" type="System">
                                    <param id="0" name="First value">LEVEL_ANIMS_TO_INIT</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Second value">LEVEL_ANIMS_INITED_CNT</param>
                                </condition>
                                <condition id="-8" name="Compare two values" sid="5123341025633361" type="System">
                                    <param id="0" name="First value">LEVEL_LAYOUT_INITED</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Second value">1</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action disabled="1" id="14" name="Log" sid="3913654627084659" type="Browser">
                                    <param id="0" name="Type">0</param>
                                    <param id="1" name="Message">&quot;StartLevel bootstrap&quot;</param>
                                </action>
                                <action id="0" name="Call function" sid="3255277236769612" type="Function">
                                    <param id="0" name="Name">&quot;StartLevelStage2&quot;</param>
                                    <param id="1" name="Parameter {n}"></param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="1988503493942841">
                    <conditions>
                        <condition id="0" name="On function" sid="2929697047297015" type="Function">
                            <param id="0" name="Name">&quot;AnimInited&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-9" name="Set value" sid="1929058994938141" type="System">
                            <param id="0" name="Variable">LEVEL_ANIMS_INITED_CNT</param>
                            <param id="1" name="Value">LEVEL_ANIMS_INITED_CNT + 1</param>
                        </action>
                        <action disabled="1" id="14" name="Log" sid="2997202378339875" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;AnimInited&quot;</param>
                        </action>
                    </actions>
                    <sub-events>
                        <event-block sid="1315579844635974">
                            <conditions>
                                <condition id="-8" name="Compare two values" sid="1660282993100161" type="System">
                                    <param id="0" name="First value">LEVEL_ANIMS_TO_INIT</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Second value">LEVEL_ANIMS_INITED_CNT</param>
                                </condition>
                                <condition id="-8" name="Compare two values" sid="1814590626142868" type="System">
                                    <param id="0" name="First value">LEVEL_LAYOUT_INITED</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Second value">1</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action disabled="1" id="14" name="Log" sid="6382506347392048" type="Browser">
                                    <param id="0" name="Type">0</param>
                                    <param id="1" name="Message">&quot;Anim inited bootstrap&quot;</param>
                                </action>
                                <action id="0" name="Call function" sid="4027384266352133" type="Function">
                                    <param id="0" name="Name">&quot;StartLevelStage2&quot;</param>
                                    <param id="1" name="Parameter {n}"></param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <comment>Second stage of initialization: init quest engine and complete animations initialization.</comment>
                <event-block sid="7628941945029601">
                    <conditions>
                        <condition id="0" name="On function" sid="4622838985728526" type="Function">
                            <param id="0" name="Name">&quot;StartLevelStage2&quot;</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action disabled="1" id="14" name="Log" sid="1526833617772792" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;StartLevelStage2&quot;</param>
                        </action>
                        <action id="0" name="Call function" sid="2396820917685016" type="Function">
                            <param id="0" name="Name">&quot;initPlayerAnimation&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                        <action id="-10" name="Set value" sid="1812225691796303" type="Player">
                            <param id="0" name="Instance variable">CurrentStage</param>
                            <param id="1" name="Value">LEVEL_FIRST_STAGE</param>
                        </action>
                        <action id="200" name="Start level" sid="4610911043383017" type="QuestLevelRuntime">
                            <param id="0" name="Level name">LEVEL_NAME</param>
                        </action>
                    </actions>
                </event-block>
                <comment>Third stage of initialization: final game start preparation after quest engine initialization.</comment>
                <comment>QuestLevelRuntime setup should run only after level has changed. See its implementation.</comment>
                <event-block sid="3608536962210634">
                    <conditions>
                        <condition id="0" name="Level changed" sid="9984593045440814" type="QuestLevelRuntime" />
                    </conditions>
                    <actions>
                        <action disabled="1" id="14" name="Log" sid="959432429981909" type="Browser">
                            <param id="0" name="Type">0</param>
                            <param id="1" name="Message">&quot;LevelChanged &quot; &amp; Player.CurrentStage</param>
                        </action>
                        <action id="2" name="Setup quest objects." sid="7533819724177504" type="QuestLevelRuntime">
                            <param id="0" name="NPC object type">NPC</param>
                        </action>
                        <action id="-15" name="Set visible" sid="9149529890147767" type="LayoutLoadingLabel">
                            <param id="0" name="Visibility">0</param>
                        </action>
                        <action id="0" name="Call function" sid="574361318582553" type="Function">
                            <param id="0" name="Name">&quot;LevelStarted&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                        <action id="0" name="Call function" sid="6043263542110386" type="Function">
                            <param id="0" name="Name">&quot;ChangeStage&quot;</param>
                            <param id="1" name="Parameter {n}">LEVEL_FIRST_STAGE</param>
                        </action>
                        <action id="0" name="Call function" sid="2717024278170931" type="Function">
                            <param id="0" name="Name">&quot;EnableInputAfterGameInited&quot;</param>
                            <param id="1" name="Parameter {n}"></param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-group>
    </events>
</c2eventsheet>
